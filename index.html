<!DOCTYPE html>
<html>
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/pyodide/v0.20.0/full/pyodide.js"></script>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.21/jquery.csv.min.js"></script>
</head>
<body class="bg-body-tertiary">

  <nav class="navbar navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand" href="#">SEND Analysis Tool</a>
        <a class="navbar-brand ms-auto" href="#">
          <img src="d2i_logo.png" alt="Logo" width="20" height="auto" class="d-inline-block align-text-top">
        </a>
      </div>
    </nav>
    <div class="container">
      <div class="row">
        <div class="col-md-6">
        </div>
          <form id="myForm">
            <input type="file" id="csvFile" accept=".csv" class="form-control" multiple/>
            <br />
            <input type="submit" value="Submit" class="btn btn-primary"/>
          </form>
        </div>
   <script>
      const myForm = document.getElementById("myForm");
      const csvFile = document.getElementById("csvFile");
      myForm.addEventListener("submit", function (e) {
         e.preventDefault();
         const files = csvFile.files;
         const csv_array = []
          Object.keys(files).forEach(i => {
            const file = files[i];
            const reader = new FileReader();
            reader.onload = (e) => {
            const text = e.target.result
            csv_array.push(text)
          // async function main() {
          //   let pyodide = await loadPyodide();
          //   await pyodide.loadPackage("pandas");
          //   await pyodide.runPythonAsync(`
          //     import pandas as pd
          //     import js
          //     from js import file
          //     import pyodide_js
          //     import json
          //     import io 

          //     print(type(file))
          //     df = pd.read_csv(io.StringIO(file))
          //     print(df)
          //   `);
          // }
          //   main()
         };
         reader.readAsText(file);
         window.files = csv_array
        })
          async function main() {
            let pyodide = await loadPyodide();
            await pyodide.loadPackage("pandas");
            await pyodide.runPythonAsync(`
            import pandas as pd
            import js
            from js import files
            import pyodide_js
            import json
            import io 

            dfs = {}
            for i, v in enumerate(files):
              dfs[i] = pd.read_csv(io.StringIO(files[i]))
              print(dfs[i])
            #  print(type(file))
            #  df = pd.read_csv(io.StringIO(file))
            #  print(df)
            `);
          }
            main()
      });
   </script>
</body>
</html>