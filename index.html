<!DOCTYPE html>
<html>
  <head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.20.0/full/pyodide.js"></script>


    <title>SEND analysis tool</title>
  </head>
  <body class="bg-body-tertiary">

    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
          <a class="navbar-brand" href="#">SEND Analysis Tool</a>
          <a class="navbar-brand ms-auto" href="#">
            <img src="d2i_logo.png" alt="Logo" width="20" height="auto" class="d-inline-block align-text-top">
          </a>
        </div>
      </nav>
      <div class="container">
        <div class="row">
          <div class="col-md-6">
              <form method="post" action="#" id="#">
                  <div class="form-group files">
                    <label>Upload Your File </label>
                    <input id="file" type="file" class="form-control" multiple="" onchange="main()" >
                  </div>

              </form>

          </div>
    </div>
      <script>
async function main() {
  window.input = document.getElementById("file").files[0];
  // get File Object  
  // var fileObject = getFile();

  // // reCreate new Object and set File Data into it
  // var newObject  = {
  //   'lastModified'     : fileObject.lastModified,
  //   'lastModifiedDate' : fileObject.lastModifiedDate,
  //   'name'             : fileObject.name,
  //   'size'             : fileObject.size,
  //   'type'             : fileObject.type
  // };  
  
  // // then use JSON.stringify on new object
  // JSON.stringify(newObject);

//   function getFiles(){
//     var files = document.getElementById("file").files;
//     var myArray = [];
//     var file = {};

//     console.log(files); // see the FileList

//     // manually create a new file obj for each File in the FileList
//     for(var i = 0; i < files.length; i++){

//       file = {
//           'lastMod'    : files[i].lastModified,
//           'lastModDate': files[i].lastModifiedDate,
//           'name'       : files[i].name,
//           'size'       : files[i].size,
//           'type'       : files[i].type,
//       } 

//       //add the file obj to your array
//       myArray.push(file)
//     }

//     //stringify array
//     console.log(JSON.stringify(myArray));
//     window.input = myArray;
// }
  // getFiles()

  let pyodide = await loadPyodide();
  await pyodide.loadPackage("pandas");
  await pyodide.runPythonAsync(`
  import pandas as pd
  import js
  from js import input
  import pyodide_js
  import json
  from io import TextIOWrapper

  file_text = input.read()
  #  data = input.to_py()
  #  unserialised = pd.read_csv(data)
  #  print(type(data))
  `);
}
      </script>

    <input type="file" onchange="showFile(this)">

    <script>
    async function showFile(input) {
      let file = input.files[0];

      let reader = new FileReader();

      reader.readAsText(file);
      console.log(file.result)
      window.input = file.result;
      alert(`File name: ${file.name}`); // e.g my.png
      alert(`Last modified: ${file.lastModified}`); // e.g 1552830408824
      let pyodide = await loadPyodide();
      await pyodide.loadPackage("pandas");
      await pyodide.runPythonAsync(`
      import pandas as pd
      import js
      from js import input
      import pyodide_js
      import json
      from io import TextIOWrapper

      file_text = input.read()
      #  data = input.to_py()
      #  unserialised = pd.read_csv(data)
      #  print(type(data))
      `);

        }
    </script>
  </body>


</html>